ARG CONTAINER_VERSION=latest
ARG CONTAINER_BASE_IMAGE=docker.io/library/ubuntu:24.04

ARG CONTAINER_IMAGE_REGISTRY=localhost
ARG CONTAINER_IMAGE_REGISTRY_REMOTE=${CONTAINER_IMAGE_REGISTRY}
ARG CONTAINER_IMAGE_NAME=wally
ARG CONTAINER_IMAGE_NAME_FULL=${CONTAINER_IMAGE_REGISTRY}/${CONTAINER_IMAGE_NAME}
ARG CONTAINER_IMAGE_VERSION=${CONTAINER_VERSION}
ARG CONTAINER_BUILDER_IMAGE=${CONTAINER_IMAGE_NAME_FULL}:${CONTAINER_IMAGE_VERSION}-builder
ARG CONTAINER_DEVEL_IMAGE=${CONTAINER_IMAGE_NAME_FULL}:${CONTAINER_IMAGE_VERSION}-devel

FROM ${CONTAINER_BASE_IMAGE} as wally-builder
ARG TARGETARCH TARGETOS TARGETPLATFORM TARGETVARIANT

RUN --mount=type=bind,source=./bin,target=/cbuild/bin \
    bash /cbuild/bin/wally-package-install.sh

RUN --mount=type=bind,source=./bin,target=/cbuild/bin \
    bash /cbuild/bin/wally-tool-chain-install.sh

FROM wally-builder as wally-devel
ARG TARGETARCH TARGETOS TARGETPLATFORM TARGETVARIANT
